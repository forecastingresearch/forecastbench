main:
  steps:
    - init:
        assign:
          - execution_results: {}
          - execution_results.step1: True
    - step1:
        parallel:
          exception_policy: continueAll
          shared: [execution_results]
          for:
            value: task
            in:
              - acled
              - manifold
              - metaculus
              - infer
            steps:
              - run:
                  try:
                    steps:
                      - init_iteration:
                          assign:
                            - execution_results:
                                ${task}: {}
                      - loop_body:
                          call: googleapis.workflowexecutions.v1.projects.locations.workflows.executions.run
                          args:
                            workflow_id: ${task + "-main"}
                          result: task_result
                      - save_successful:
                          assign:
                            - execution_results:
                                ${task}: {"success": True}
                  except:
                      as: e
                      steps:
                        - save_failed:
                             steps:
                               - handle_error:
                                   assign:
                                     - execution_results:
                                         failure: True
                                         ${task}: {"failure": True}
                                         ${task}: {"exception": '${e.operation.error.payload}'}
    - check_exception_encountered:
         switch:
           - condition: ${"failure" in execution_results}
             steps:
               - raise_exception:
                   raise: ${execution_results}
           - condition: ${not("failure" in execution_results)}
             steps:
               - assign_success:
                   assign:
                     - execution_results.success: True
    - return_execution_results:
        return: ${execution_results}
