main:
  steps:
    - init:
        assign:
          - execution_results: {}
          - execution_results.wikidata: {}
    - wikidata_fetch:
        try:
          steps:
              - fetch:
                  call: http.post
                  args:
                      url: https://SUBDOMAIN.cloudfunctions.net/wikidata_fetch
                      auth:
                           type: OIDC
                  result: api_response_fetch
              - save_successful_fetch:
                  assign:
                    - execution_results.wikidata.success: True
                    - execution_results.wikidata.fetch: ${api_response_fetch}
        retry: ${http.default_retry}
        except:
            as: e
            steps:
                - save_failed_fetch:
                    assign:
                      - execution_results.wikidata.exception: ${e}
                - raise_fetch_exception:
                    raise: ${execution_results}
    - wikidata_update_questions:
        try:
          steps:
              - update_questions:
                  call: http.post
                  args:
                      url: https://SUBDOMAIN.cloudfunctions.net/wikidata_update_questions
                      auth:
                           type: OIDC
                  result: api_response_update_questions
              - save_successful_update_questions:
                  assign:
                    - execution_results.wikidata.success: True
                    - execution_results.wikidata.update_questions: ${api_response_update_questions}
        retry: ${http.default_retry}
        except:
            as: e
            steps:
                - save_failed_update_questions:
                    assign:
                      - execution_results.wikidata.exception: ${e}
                - raise_update_questions_exception:
                    raise: ${execution_results}
    - check_exception_encountered:
        switch:
          - condition: ${"failure" in execution_results}
            steps:
              - raise_exception:
                  raise: ${execution_results}
          - condition: ${not("failure" in execution_results)}
            steps:
              - assign_success:
                  assign:
                    - execution_results.success: True
    - return_execution_results:
        return: ${execution_results}
